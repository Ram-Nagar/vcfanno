<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="canonical" href="https://github.com/brentp/vcfanno/"> 
    <link rel="shortcut icon" href="./img/favicon.ico">

    <title>vcfanno</title>

    <link href="./css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="./css/base.css" rel="stylesheet">
    <link href="./css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/highlight.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body class="homepage" >

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href=".">vcfanno</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="active">
                        <a href=".">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="performance_tips/">Performance</a>
                    </li>
                
                
                
                    <li >
                        <a href="CHANGES/">Changes</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="examples/clinvar_exac/">ClinvarExac</a>
</li>

                        
                            
<li >
    <a href="examples/cadd/">CADD</a>
</li>

                        
                            
<li >
    <a href="examples/exac_combine/exac_combine/">ExAC-Combine</a>
</li>

                        
                            
<li >
    <a href="examples/gff_sv/gff_sv/">SV + GFF</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li class="disabled">
                        <a rel="next" >
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="performance_tips/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/brentp/vcfanno">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#vcfanno">vcfanno</a></li>
        
    
        <li class="first-level "><a href="#overview">Overview</a></li>
        
    
        <li class="first-level "><a href="#usage">Usage</a></li>
        
            <li class="second-level"><a href="#example">Example</a></li>
            
        
            <li class="second-level"><a href="#typecasting-values">Typecasting values</a></li>
            
        
    
        <li class="first-level "><a href="#operations">Operations</a></li>
        
    
        <li class="first-level "><a href="#postannotation">PostAnnotation</a></li>
        
    
        <li class="first-level "><a href="#additional-usage">Additional Usage</a></li>
        
            <li class="second-level"><a href="#-ends">-ends</a></li>
            
        
            <li class="second-level"><a href="#-permissive-overlap">-permissive-overlap</a></li>
            
        
            <li class="second-level"><a href="#-p">-p</a></li>
            
        
            <li class="second-level"><a href="#-lua">-lua</a></li>
            
        
    
        <li class="first-level "><a href="#mailing-list">Mailing List</a></li>
        
    
        <li class="first-level "><a href="#installation">Installation</a></li>
        
    
        <li class="first-level "><a href="#multi-allelics">Multi-Allelics</a></li>
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="vcfanno">vcfanno</h1>
<!--
build:
 VERSION=0.1.0; goxc -build-ldflags "-X main.VERSION=$VERSION" -include docs/,example/,README.md -d /tmp/vcfanno/ -pv=$VERSION -bc='linux,darwin,windows,!arm'
-->

<p><a href="https://travis-ci.org/brentp/vcfanno"><img alt="Build Status" src="https://travis-ci.org/brentp/vcfanno.svg" /></a>
<a href="http://brentp.github.io/vcfanno/"><img alt="Docs" src="https://img.shields.io/badge/docs-latest-blue.svg" /></a></p>
<h1 id="overview">Overview</h1>
<p>vcfanno allows you to quickly annotate your VCF with any number of INFO fields from any number of VCFs or BED files.
It uses a simple conf file to allow the user to specify the source annotation files and fields and how they will
added to the info of the query VCF.</p>
<ul>
<li>For VCF, values are pulled by name from the INFO field with special-cases of <em>ID</em> and <em>FILTER</em> to pull from those VCF columns.</li>
<li>For BED, values are pulled from (1-based) column number.</li>
<li>For BAM, depth (<code>count</code>), "mapq" and "seq" are currently supported.</li>
</ul>
<p><code>vcfanno</code> is written in <a href="http://golang.org">go</a> and it supports custom user-scripts written in lua.
It can annotate more than 8,000 variants per second with 34 annotations from 9 files on a modest laptop and over 30K variants per second using 12 processes on a server.</p>
<p>We are actively developing <code>vcfanno</code> and appreciate feedback and bug reports.</p>
<p><img src="https://raw.githubusercontent.com/brentp/vcfanno/master/docs/img/vcfanno-overview-final.png" width="676" height="367" /></p>
<h1 id="usage">Usage</h1>
<p>After downloading the <a href="https://github.com/brentp/vcfanno/releases/">binary for your system</a> (see section below) usage looks like:</p>
<pre><code class="Shell">  ./vcfanno -lua example/custom.lua example/conf.toml example/query.vcf.gz
</code></pre>

<p>Where conf.toml looks like:</p>
<pre><code>[[annotation]]
file=&quot;ExAC.vcf&quot;
# ID and FILTER are special columns is a special field that pull the ID and FILTER columns from the vcf
fields = [&quot;AC_AFR&quot;, &quot;AC_AMR&quot;, &quot;AC_EAS&quot;, &quot;ID&quot;, &quot;FILTER&quot;]
ops=[&quot;self&quot;, &quot;self&quot;, &quot;min&quot;, &quot;self&quot;, &quot;self&quot;]
names=[&quot;exac_ac_afr&quot;, &quot;exac_ac_amr&quot;, &quot;exac_ac_eas&quot;, &quot;exac_id&quot;, &quot;exac_filter&quot;]

[[annotation]]
file=&quot;fitcons.bed&quot;
columns = [4, 4]
names=[&quot;fitcons_mean&quot;, &quot;lua_sum&quot;]
# note the 2nd op here is lua that has access to `vals`
ops=[&quot;mean&quot;, &quot;lua:function sum(t) local sum = 0; for i=1,#t do sum = sum + t[i] end return sum / #t end&quot;]

[[annotation]]
file=&quot;example/ex.bam&quot;
names=[&quot;ex_bam_depth&quot;]
fields=[&quot;depth&quot;, &quot;mapq&quot;, &quot;seq&quot;]
ops=[&quot;count&quot;, &quot;mean&quot;, &quot;concat&quot;]
</code></pre>

<p>So from <code>ExAC.vcf</code> we will pull the fields from the info field and apply the corresponding
<code>operation</code> from the <code>ops</code> array. Users can add as many <code>[[annotation]]</code> blocks to the
conf file as desired. Files can be local as above, or available via http/https.</p>
<p>See the additional usage section at the bottom for more.</p>
<h2 id="example">Example</h2>
<p>the example directory contains the data and conf for a full example. To run, download
the <a href="https://github.com/brentp/vcfanno/releases/">appropriate binary</a> for your system</p>
<p>Then, you can annotate with:</p>
<pre><code class="Shell">./vcfanno -p 4 -lua example/custom.lua example/conf.toml example/query.vcf.gz &gt; annotated.vcf
</code></pre>

<p>An example INFO field row before annotation (pos 98683):</p>
<pre><code>AB=0.282443;ABP=56.8661;AC=11;AF=0.34375;AN=32;AO=45;CIGAR=1X;TYPE=snp
</code></pre>

<p>and after:</p>
<pre><code>AB=0.2824;ABP=56.8661;AC=11;AF=0.3438;AN=32;AO=45;CIGAR=1X;TYPE=snp;AC_AFR=0;AC_AMR=0;AC_EAS=0;fitcons_mean=0.061;lua_sum=0.061
</code></pre>

<h2 id="typecasting-values">Typecasting values</h2>
<p>By default, using <code>ops</code> of <code>mean</code>,<code>max</code>,<code>sum</code>,<code>div2</code> or <code>min</code> will result in <code>type=Float</code>,
using <code>self</code> will get the type from the annotation VCF and other fields will have <code>type=String.
It's possible to add field type info to the field name. To change the field type add</code>_int<code>or</code>_float` to the field name. This suffix will be parsed and removed, and your field
will be of the desired type. </p>
<h1 id="operations">Operations</h1>
<p>In most cases, we will have a single annotation entry for each entry (variant)
in the query VCF, in which case the <code>self</code> op is the best choice. However, it is
possible that there will be multiple annotations from a single annotation file--in
this case, the op determines how the many values are <code>reduced</code>. Valid operations are:</p>
<ul>
<li>lua:$lua // see section below for more details</li>
<li>self     // pull directly from the annotation and handle multi-allelics.</li>
<li>concat   // comma delimited list of output</li>
<li>count    // count the number of overlaps</li>
<li>div2     // given two values a, b return a / b.</li>
<li>first    // take only the first value. </li>
<li>flag     // presense/absence via vcf flag</li>
<li>max      // numbers only</li>
<li>mean     // numbers only</li>
<li>min      // numbers only</li>
<li>sum      // numbers only</li>
<li>uniq     // comma-delimited list of uniq values</li>
<li>by_alt   // comma-delimited by alt (Number=A), pipe-delimited (|) for multiple annos for the same alt.</li>
</ul>
<p>There are some operations that are only for <code>postannotation</code>:</p>
<ul>
<li>delete   // remove fields from the query vcf's INFO.</li>
<li>setid    // set the ID file of the query vcf with values from its INFO.</li>
</ul>
<p>In nearly all cases, <strong>if you are annotating with a VCF. use <code>self</code></strong></p>
<p>Note that when the file is BAM, the operation is determined by the field name ('seq', 'mapq', 'DP2', 'coverage' are supported).</p>
<h1 id="postannotation">PostAnnotation</h1>
<p>One of the most powerful features of <code>vcfanno</code> is the embedded scripting language, lua, combined with <em>postannotation</em>.
<code>[[postannotation]]</code> blocks occur after all the annotations have been applied. They are similar, but in the fields
column, they request a number of columns from the query file (including the new columns added in annotation). For example
if we have AC and AN columns indicating the alternate count and the number of chromosomes, respectively, we could create
a new allele frequency column, <em>AF</em> with this block:</p>
<pre><code>[[postannotation]]
fields=[&quot;AC&quot;, &quot;AN&quot;]
op=&quot;lua:AC / AN&quot;
name=&quot;AF&quot;
type=&quot;Float&quot;
</code></pre>

<p>where the type field is one of the types accepted in VCF format, the <code>name</code> is the name of the field that is created, the <em>fields</em>
indicate the fields (from the INFO) that will be available to the op, and the <em>op</em> indicates the action to perform. This can be quite
powerful. For an extensive example that demonstrates the utility of this type of approach, see
<a href="http://brentp.github.io/vcfanno/examples/clinvar_exac/">docs/examples/clinvar_exac.md</a>.</p>
<p>A user can set the ID field of the VCF in a <code>[[postannotation]]</code> block by using <code>name=ID</code>. For example:</p>
<pre><code>[[postannotation]]
name=&quot;ID&quot;
fields=[&quot;other_field&quot;, &quot;ID&quot;]
op=&quot;lua:other_field .. ';' .. ID&quot;
type=&quot;String&quot;
</code></pre>

<p>will take the value in <code>other_field</code>, concatenate it with the existing ID, and set the ID to that value.</p>
<p>see the <code>setid</code> function in <code>examples/custom.lua</code> for a more robust method of doing this.</p>
<h1 id="additional-usage">Additional Usage</h1>
<h2 id="-ends">-ends</h2>
<p>For annotating large variants, such as CNVs or structural variants (SVs), it can be useful to
annotate the <em>ends</em> of the variant in addition to the region itself. To do this, specify the <code>-ends</code>
flag to <code>vcfanno</code>. e.g.:</p>
<pre><code class="Shell">vcfanno -ends example/conf.toml example/query.vcf.gz
</code></pre>

<p>In this case, the names field in the <em>conf</em> file contains, "fitcons_mean". The output will contain
<code>fitcons\_mean</code> as before along with <code>left\_fitcons\_mean</code> and <code>right\_fitcons\_mean</code> for any variants
that are longer than 1 base. The <em>left</em> end will be for the single-base at the lowest base of the variant
and the <em>right</em> end will be for the single base at the higher numbered base of the variant.</p>
<h2 id="-permissive-overlap">-permissive-overlap</h2>
<p>By default, when annotating with a variant, in addition to the overlap requirement, the variants must share
the same position, the same reference allele and at least one alternate allele (this is only used for
variants, not for BED/BAM annotations). If this flag is specified, only overlap testing is used and shared
REF/ALT are not required.</p>
<h2 id="-p">-p</h2>
<p>Set to the number of processes that <code>vcfanno</code> can use during annotation. <code>vcfanno</code> parallelizes well
up to 15 or so cores.</p>
<h2 id="-lua">-lua</h2>
<p>custom in ops (lua). For use when the built-in <code>ops</code> don't supply the needed reduction.</p>
<p>we embed the lua engine <a href="https://github.com/yuin/gopher-lua">go-lua</a> so that it's 
possible to create a custom op if it is not provided. For example if the users wants to</p>
<pre><code>"lua:function sum(t) local sum = 0; for i=1,#t do sum = sum + t[i] end return sum end"
</code></pre>
<p>where the last value (in this case sum) is returned as the annotation value. It is encouraged
to instead define lua functions in separate <code>.lua</code> file and point to it when calling
<code>vcfanno</code> using the <code>-lua</code> flag. So, in an external file, "some.lua", instead put:</p>
<pre><code class="lua">function sum(t)
    local sum = 0
    for i=1,#t do
        sum = sum + t[i]
    end
    return sum
end
</code></pre>

<p>And then the above custom op would be: "lua:sum(vals)". (note that there's a sum op provided
by <code>vcfanno</code> which will be faster).</p>
<p>The variables <code>vals</code>, <code>chrom</code>, <code>start</code>, <code>stop</code>, <code>ref</code>, <code>alt</code> from the currently
variant will all be available in the lua code. <code>alt</code> will be a table with length
equal to the number of alternate alleles. Example usage could be:</p>
<pre><code>op=&quot;lua:ref .. '/' .. alt[1]&quot;
</code></pre>

<p>See <a href="https://github.com/brentp/vcfanno/blob/master/example/conf.toml">example/conf.toml</a>
and <a href="https://github.com/brentp/vcfanno/blob/master/example/custom.lua">example/custom.lua</a>
for more examples.</p>
<h1 id="mailing-list">Mailing List</h1>
<p><a href="https://groups.google.com/forum/#!forum/vcfanno">Mailing List</a><a href="https://groups.google.com/forum/#!forum/vcfanno"><img alt="Mailing List" src="http://www.google.com/images/icons/product/groups-32.png" /></a></p>
<h1 id="installation">Installation</h1>
<p>please download a static binary (executable) from <a href="https://github.com/brentp/vcfanno/releases">here</a> and copy it into your '$PATH'.
There are no dependencies.</p>
<p>If you use <a href="https://bioconda.github.io/">bioconda</a>, you can install with: <code>conda install -c bioconda vcfanno</code></p>
<h1 id="multi-allelics">Multi-Allelics</h1>
<p>A multi-allelic variant is simply a site where there are multiple, non-reference alleles seen in the population. These will
appear as e.g. <code>REF="A", ALT="G,C"</code>. As of version 0.2, <code>vcfanno</code> will handle these fully with op="self" when the Number from
the VCF  header is A (Number=A)</p>
<p>For example this table lists Alt columns query and annotation (assuming the REFs and position match) along with the values from
the annotation and shows how the query INFO will be filled:</p>
<p>| query  | anno | anno vals  |         |
| ALTS   | ALTS | from INFO  | result  |
| ------ | ---- | ---------- | ------- |
| C,G    | C,G  | 22,23      | 22,23   |
| C,G    | C,T  | 22,23      | 22,.    |
| C,G    | T,G  | 22,23      | .,23    |
| G,C    | C,G  | 22,23      | 23,22   |
| C,G    | C    | YYY        | YYY,.   |
| G,C,T  | C    | YYY        | .,YYY,. |
| C,T    | G    | YYY        | .,.     |
| T,C    | C,T  | AA,BB      | BB,AA   | # note values are flipped</p>
<p>So values that are not present in the annotation are filled with '.' as a place-holder.</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="./js/jquery-1.10.2.min.js"></script>
    <script src="./js/bootstrap-3.0.3.min.js"></script>
    <script src="./js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '.';
    </script>
    <script data-main="./mkdocs/js/search.js" src="./mkdocs/js/require.js"></script>
    <script src="./js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>

<!--
MkDocs version : 0.16.2
Build Date UTC : 2018-08-01 22:24:21
-->
